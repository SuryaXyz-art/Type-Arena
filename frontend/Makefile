.PHONY: build check test clean deploy run

# Build all applications
build:
	@echo "ğŸ”¨ Building Flash Markets..."
	cargo build --release --target wasm32-unknown-unknown
	@echo "âœ… Build complete!"

# Quick check without building
check:
	@echo "ğŸ” Checking code..."
	cargo check --target wasm32-unknown-unknown
	@echo "âœ… Check complete!"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	cargo test
	@echo "âœ… Tests complete!"

# Lint code
lint:
	@echo "ğŸ§¹ Linting code..."
	cargo clippy --target wasm32-unknown-unknown
	@echo "âœ… Lint complete!"

# Format code
fmt:
	@echo "ğŸ“ Formatting code..."
	cargo fmt
	@echo "âœ… Format complete!"

# Clean build artifacts
clean:
	@echo "ğŸ—‘ï¸ Cleaning build artifacts..."
	cargo clean
	@echo "âœ… Clean complete!"

# Build individual apps
build-token:
	@echo "ğŸ”¨ Building Token app..."
	cargo build -p token --release --target wasm32-unknown-unknown

build-market:
	@echo "ğŸ”¨ Building Market app..."
	cargo build -p market --release --target wasm32-unknown-unknown

build-oracle:
	@echo "ğŸ”¨ Building Oracle app..."
	cargo build -p oracle --release --target wasm32-unknown-unknown

# Docker commands
docker-build:
	@echo "ğŸ³ Building Docker image..."
	docker compose build
	@echo "âœ… Docker build complete!"

docker-up:
	@echo "ğŸ³ Starting Docker containers..."
	docker compose up -d
	@echo "âœ… Containers started!"

docker-down:
	@echo "ğŸ³ Stopping Docker containers..."
	docker compose down
	@echo "âœ… Containers stopped!"

docker-logs:
	@echo "ğŸ“œ Showing Docker logs..."
	docker compose logs -f

# Development workflow
dev: check build
	@echo "âœ… Development build complete!"

# Production workflow
prod: clean lint test build
	@echo "âœ… Production build complete!"

# Quick start
quick: build docker-up
	@echo "âœ… Flash Markets is running!"
	@echo "ğŸ“¡ GraphQL: http://localhost:8080/graphql"
	@echo "ğŸŒ Frontend: http://localhost:3000"

# Help
help:
	@echo "Flash Markets - Makefile Commands"
	@echo ""
	@echo "  make build         - Build all applications"
	@echo "  make check         - Quick code check"
	@echo "  make test          - Run tests"
	@echo "  make lint          - Run clippy"
	@echo "  make fmt           - Format code"
	@echo "  make clean         - Clean build artifacts"
	@echo ""
	@echo "  make docker-build  - Build Docker image"
	@echo "  make docker-up     - Start containers"
	@echo "  make docker-down   - Stop containers"
	@echo "  make docker-logs   - View logs"
	@echo ""
	@echo "  make dev           - Quick development build"
	@echo "  make prod          - Full production build"
	@echo "  make quick         - Build and start everything"
